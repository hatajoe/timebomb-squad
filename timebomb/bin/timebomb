#!/usr/bin/perl --

use strict;
use warnings;

my $cmd = "node app.js >log 2>&1";
my $end = 0;


# endress reconnect
while (!$end) {

    my $pid = fork();

    if ($pid) {

        $SIG{INT} = sub {
            kill 9, $pid if ($pid);
            $end = 1;
        };

        # parent
        wait();

    } elsif (defined $pid) {

        # child
        my $ret = system($cmd);
        exit;

    } else {
        die "failed to fork\n";
    }

}

print "finish\n";
